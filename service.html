<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Service Requests</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>Barangay Service Hub</h1>
      <nav>
        <a href="dashboard.html">Dashboard</a>
        <a href="incident.html">Incident Reporting</a>
        <a href="certificate.html">Certificates</a>
        <a href="service.html">Service Requests</a>
      </nav>
    </header>
    <main>
      <h2>Service Requests</h2>
      <form>
        <label>Resident Name <input type="text" name="fullname" /></label>
        <label>Contact <input type="text" name="contact" /></label>
        <label
          >Service Type
          <select name="service">
            <option>Select service</option>
          </select></label
        >
        <label>Preferred Schedule <input type="date" name="schedule" /></label>
        <label
          >Details / Notes
          <textarea
            name="details"
            placeholder="Additional information or accessibility needs"
          ></textarea>
        </label>
        <div class="form-actions">
          <button type="reset">Reset</button>
          <button type="submit">Request Service</button>
        </div>
      </form>
      <aside>
        <h3>Recent Submissions</h3>
        <ul>
          <li>
            <span class="status pending"></span> Barangay Clearance (Pending)
          </li>
          <li>
            <span class="status progress"></span> Road hazard - Brgy. Hall (In
            Progress)
          </li>
          <li>
            <span class="status scheduled"></span> Senior Aid Request
            (Scheduled)
          </li>
        </ul>
        <h4>How it works</h4>
        <ol>
          <li>Resident submits form</li>
          <li>Staff receives & assigns</li>
          <li>Status updated (Pending → In-Progress → Resolved)</li>
        </ol>
      </aside>
      <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
      <script>
        window.addEventListener("DOMContentLoaded", function () {
          const supabaseUrl = "https://kviqjumgvdregxqdzpka.supabase.co";
          const supabaseKey =
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2aXFqdW1ndmRyZWd4cWR6cGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNDc1NDQsImV4cCI6MjA3MjYyMzU0NH0.WXw4cgioSHtz577jcagAGIVa-9Uc6tgPWDKQEvyF2Xs";
          const supabase = supabase.createClient(supabaseUrl, supabaseKey);

          document
            .querySelector("form")
            .addEventListener("submit", async function (e) {
              e.preventDefault();
              const form = e.target;
              const resident_name = form.fullname.value;
              const contact_info = form.contact.value;
              const service_type = form.service.value;
              const details = form.details.value;
              const preferred_schedule = form.schedule.value;
              const status = "Pending";
              const request_date = new Date().toISOString();
              const { data, error } = await supabase
                .from("ServiceRequests")
                .insert([
                  {
                    resident_name,
                    contact_info,
                    service_type,
                    details,
                    preferred_schedule,
                    status,
                    request_date,
                  },
                ]);
              if (error) {
                alert("Error submitting: " + error.message);
              } else {
                alert("Service request submitted successfully!");
                form.reset();
              }
            });
        });
      </script>
    </main>
  </body>
</html>
